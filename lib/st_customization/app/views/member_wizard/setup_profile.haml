// main block for all wizard steps
.page-content-inner.wizard.wizard-member
  .head-section
    %h1.head-section-title Set up your profile
  = render partial: 'tutor_wizard/wizard_head'
  .wizard-section
    .errors
    %h2.small-title.flex-block 
      .title-image-holder
        = image_tag "custom_images/choose-profile-pic.png"
      Upload your profile picture
    .wizard-content
      %p.mb-25 This will be your profile picture - and what your tutors will see. 
      %p.mb-25 Attach as recent a photo of yourself as possible. The photo needs to clearly show your face, so it’s best to choose a photo where you’re not wearing sunglasses, or overly large hats. 
      .wizard-inner
        .upload-files-holder
          .row
            .col-5
        .row
          .col-6
            .need-upload
              = form_for @custom_profile, url: profile_upload_avatar_path(@custom_profile), html: { multipart: true, id: "fileupload" } do |f|
                = f.file_field :avatar
                -# = link_to '#', class: 'btn btn--black upload-link' do
                = label_tag :custom_profile_avatar, class: 'btn btn--black upload-link' do
                  .small-icon
                    %svg.svg-inline--fa.fa-file-upload.fa-w-12{"aria-hidden" => "true", "data-icon" => "file-upload", "data-prefix" => "fas", :focusable => "false", :role => "img", :viewbox => "0 0 384 512", :xmlns => "http://www.w3.org/2000/svg"}
                      %path{:d => "M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm65.18 216.01H224v80c0 8.84-7.16 16-16 16h-32c-8.84 0-16-7.16-16-16v-80H94.82c-14.28 0-21.41-17.29-11.27-27.36l96.42-95.7c6.65-6.61 17.39-6.61 24.04 0l96.42 95.7c10.15 10.07 3.03 27.36-11.25 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z", :fill => "currentColor"}
                  Choose file
                // = f.submit 'Next step', class: 'btn btn--violet get-badge'
              %table.table.table-striped.uploaded-file-container.profile-upload
                %tbody.files{data: {toggle: "modal-gallery", target: "#modal-gallery"}}
                  %tr
                    %td
                      .uploaded-file
                        .thumb-block
                          = image_tag @custom_profile.avatar.url(:thumb) if @custom_profile.avatar.present?
                        .file-action-block
                          .file-name #{@custom_profile.avatar.original_filename}
                          = link_to 'Choose another photo', '#', class: 'green link underline trigger_upload'
  
    %h2.small-title.flex-block 
      .title-image-holder
        = image_tag "custom_images/edit.png"
      Write something about yourself (optional)
    -# .errors
    .wizard-content
      .wizard-inner
        %p.mb-25 You can write a short paragraph introducing yourself to your tutors and other students if you wish! Bizaar is above all a community - writing a short introduction might help letting others know more about you.
        %p 
          Max #{CustomProfile::MAX_DESCRIPTION_LENGTH} characters / 
          %span.written-char 0
        = form_for @custom_profile, remote: true, format: :json, authenticity_token: true, html: { id: "custom_profile_form" } do |f|
          = f.text_area :description, cols: 20, rows: 10, maxlength: CustomProfile::MAX_DESCRIPTION_LENGTH

          .row
            .col-6
              = link_to "Next", "#", class: 'submit_remote_form_btn btn btn--violet block', remote: true
            -# .col-6
            -#   = link_to "Skip this step", member_wizard_skip_step_path(@member_status.signup_status), class: 'block skip-btn'

= render partial: 'view_tools/remote_form_submit_handler'
= render partial: 'view_tools/confirm_step_btn_js'

:javascript
  onDocumentReady(function(){
    $('.trigger_upload').on('click', function(event) {
      event.preventDefault();
      $('input[type="file"]').trigger('click');
    });

    $('#fileupload').fileupload({
      done: function (e, data) {
        if (data.result.error === undefined) {
          var file = data.files[0];
          var name = file.name;

          $('.table-striped .files').find('.file-name').text(name);
          $('.table-striped .files').find('.thumb-block img').attr('src', data.result.image_url);
          $('.uploaded-file-container.profile-upload').css('display', 'block');
          $('.uploaded-file').show();
        } else {
          alert(data.result.error);
        }
      }
    });

    $('#custom_profile_avatar').on('change', function(event) {
      var file = this.files[0];
      var reader = new FileReader();
      var name = file.name;

      reader.onload = function(e) {
        var img = new Image();
        img.src = reader.result;

        $('.thumb-block').html(img);
        // $('.file-name').html(name);
      }
      
      reader.readAsDataURL(file);

    });

    if($('.thumb-block img').length === 0) {
      $('.uploaded-file').hide();
    } else {
      $('.uploaded-file').show();
    }

  });
  