- content_for :title_header do
  %h1= t("layouts.no_tribe.settings")

= render :partial => "layouts/left_hand_navigation", :locals => { :links => custom_settings_links_for(@current_user, @current_community) }

.left-navi-section.settings-section.qualifications-section
  .settings-form
    .settings-title
      %h3.section-subtitle.violet= t(".title")
      = link_to '#', class: 'edit-settings-button' do
        .icon-edit
    - if @certification_was_created
      .success_message_spoiler
        Done!
    = form_for @new_certification, remote: true, html: { multipart: true, id: 'new_certification_form_ajax_form', class: 'certification_form' }, authenticity_token: true do |f|
      .row
        .col-6
          = f.select :category_id, categories_for_select, {}, { id: "category-select", class: 'custom-select', data: {:placeholder => 'Choose a Category for your Qualification'} }
          -# = select :category_id, categories_for_select, {}, { id: "category-select", data: {:placeholder => 'Choose a Category for your Qualification'} }, class: 'custom-select'
        .col-6
          = f.text_field :name, placeholder: 'The name of your Qualification', class: "input"
          -# = text_field :name, placeholder: 'The name of your Qualification', class: "input"
      .row
        .col-6
          .upload-files-holder
            = label_tag :certification_image, class: 'btn btn--black upload-link' do
              .small-icon
                %svg.svg-inline--fa.fa-file-upload.fa-w-12{"aria-hidden" => "true", "data-icon" => "file-upload", "data-prefix" => "fas", :focusable => "false", :role => "img", :viewbox => "0 0 384 512", :xmlns => "http://www.w3.org/2000/svg"}
                  %path{:d => "M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm65.18 216.01H224v80c0 8.84-7.16 16-16 16h-32c-8.84 0-16-7.16-16-16v-80H94.82c-14.28 0-21.41-17.29-11.27-27.36l96.42-95.7c6.65-6.61 17.39-6.61 24.04 0l96.42 95.7c10.15 10.07 3.03 27.36-11.25 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z", :fill => "currentColor"}
              Upload Files from computer
            = f.file_field :image
            .uploaded-file-container.settings
              .pdfPreview.hidden-preview
                = image_tag 'custom_images/pdf.png', class: 'image'
    = button_tag 'Get my badge!', class: 'remote_ent_form_submit_btn form-element'
    .row.existing_certifications_container
      .existing_certifications.pending_certifications
        - if @pending_certifications.present?
          %h3
            Pending certifications
        - @pending_certifications.each do |cert|
          - cat_name = cert.category_name  
          .row
            .col-6
              = cat_name
            .col-6
              = cert.name
            .certificate-item
              .thumb-block
                = image_tag cert.attachment_thumb_url, class: 'image'
              .certificate-description
                .file-name.qualification-name
                  = cert.name
                .file-name.category-name
                  = cat_name
                = label :_destroy, 'Remove this photo', class: 'green link underline remove-photo'
                = check_box :_destroy, '', class: 'remove-cert-checkbox', data: {'cert_id' => cert.id}
      .existing_certifications.approved_certifications
        - if @approved_certifications.present?
          %h3
            Approved certifications
        - @approved_certifications.each do |cert|
          - cat_name = cert.category_name  
          .row
            .col-6
              = cat_name
            .col-6
              = cert.name
            .certificate-item
              .thumb-block
                = image_tag cert.attachment_thumb_url, class: 'image'
              .certificate-description
                .file-name.qualification-name
                  = cert.name
                .file-name.category-name
                  = cat_name
                = label :_destroy, 'Remove this photo', class: 'green link underline remove-photo'
                = check_box :_destroy, '', class: 'remove-cert-checkbox', data: {'cert_id' => cert.id}
      .existing_certifications.approved_certifications
        - if @rejected_certifications.present?
          %h3
            Rejected certifications
        - @rejected_certifications.each do |cert|
          - cat_name = cert.category_name  
          .row
            .col-6
              = cat_name
            .col-6
              = cert.name
            .col-6
              = cert.rejection_reason
            .certificate-item
              .thumb-block
                = image_tag cert.attachment_thumb_url, class: 'image'
              .certificate-description
                .file-name.qualification-name
                  = cert.name
                .file-name.category-name
                  = cat_name
                = label :_destroy, 'Remove this photo', class: 'green link underline remove-photo'
                = check_box :_destroy, '', class: 'remove-cert-checkbox', data: {'cert_id' => cert.id}
    .verified-holder
      .bold.uppercase You have recieved the following badge for this qualification:
      .verify-sign.badge-holder
        = image_tag "homepage/medal.png", class: 'small-icon'
        %span.uppercase.green.text Competitor
    = link_to '+ Add another qualification', '#', class: 'underline uppercase add-another-qual'

  -# = render partial: 'admin/community_listings/table', locals: {placeholder: t('layouts.settings.listings_search_placeholder')}

= render partial: 'certifications_js_handlers'
= render partial: 'view_tools/ajax_form_submit_handler'

:javascript
  onDocumentReady(function() {
    $('.remote_ent_form_submit_btn').on("click", function(){
      formAjaxSubmit('#new_certification_form_ajax_form');
    });

    $('.remove-cert-checkbox').on('click', function(){
      //console.log($(this).data('certId'))
      var delete_url = "#{certifications_path.split('?').first}" + "/" + $(this).data('certId') + "";
      deleteItem(delete_url);
    });
  });

